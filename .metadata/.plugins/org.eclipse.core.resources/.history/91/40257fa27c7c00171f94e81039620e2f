package br.vaga.emprego.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import javax.ws.rs.Path;
import javax.ws.rs.Produces;

import com.google.gson.Gson;

import br.vaga.emprego.conexao.Conexao;
import br.vaga.emprego.dto.CampanhaDTO;

@Path("CampanhasDAO")
public class CampanhasDAO extends Conexao {
	
	private Connection conexao;
	
	
	@Produces("text/plain")
	@Path("consultarCampanhas")
	public String consultarCampanhas() throws SQLException {
		List<CampanhaDTO> campanhas = new ArrayList<CampanhaDTO>();
		try {
			conexao = conectarBase();
			PreparedStatement statement =  conexao.prepareStatement("Select * from tbl_campanha");
			ResultSet resultado =  statement.executeQuery();
		
			if(resultado != null) {
				while (resultado.next()) {
					CampanhaDTO campanha = new CampanhaDTO();
					campanha.setIdentificador(resultado.getInt("identificador"));
					campanha.setDescricao(resultado.getString("descricao"));
					campanha.setDataInicial(resultado.getDate("dataInicial"));
					campanha.setDataFinal(resultado.getDate("dataFinal"));
					campanhas.add(campanha);
				}
			}
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		finally {
			if(conexao != null && !conexao.isClosed()) {
				conexao.close();
			}
		}
		
		Gson json = new Gson();
		String response = json.toJson(campanhas);
		
		
		return response;
	}
	
	@Produces("text/plain")
	@Path("gravarCampanha")
	public String gravarCampanha() {
		try {
			conexao = conectarBase();
			PreparedStatement statement =  conexao.prepareStatement("insert into tbl_campanha(identificador,descricao,dataInicial,dataFinal)"
					+ " values(SeqCampanha.nextval,?,?,?)");

			 java.util.Date dataUtil = new java.util.Date();
			 java.sql.Date dataSql = new java.sql.Date(dataUtil.getTime());
	         statement.setString(1, "teste");
	         statement.setDate(2, dataSql);
	         statement.setDate(3, dataSql);
			
			int retorno =  statement.executeUpdate();
			ResultSet tableKeys = statement.getGeneratedKeys();
		    tableKeys.next();
		    int autoGeneratedID = tableKeys.getInt(1);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return "";
		
	}
	


}
