package br.com.vagas.emprego.service;

import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Map;

import br.com.vagas.emprego.utils.IOUtils;

public class Servico {

	  public String doGet(String url, Map<String, String> params, String charset) throws IOException {

	        String queryString = getQueryString(params);

	        if (LOG_ON && queryString.length() > 0) {
	            Log.d(TAG, ">> Http.doGet: " + queryString);
	        }

	        URL u = new URL(url);
	        HttpURLConnection conn = null;
	        String s = null;
	        try {
	            conn = (HttpURLConnection) u.openConnection();
	            if (contentType != null) {
	                conn.setRequestProperty("Content-Type", contentType);
	            }
	            conn.setRequestMethod("GET");
	            conn.setConnectTimeout(TIMEOUT_MILLIS);
	            conn.setReadTimeout(TIMEOUT_MILLIS);
	            conn.setRequestProperty("CustomHeader", queryString);
	            conn.connect();
	            InputStream in = null;
	            int status = conn.getResponseCode();
	            if (status >= HttpURLConnection.HTTP_BAD_REQUEST) {
	                Log.d(TAG, "Error code: " + status);
	                in = conn.getErrorStream();
	            } else {
	                in = conn.getInputStream();
	            }
	            s = IOUtils.toString(in, charset);
	            if (LOG_ON) {
	                Log.d(TAG, "<< Http.doGet: " + s);
	            }
	            in.close();
	        } catch (IOException e) {
	            throw e;
	        } finally {
	            if (conn != null) {
	                conn.disconnect();
	            }
	        }

	        return s;
	    }
	
}
